
<html lang="en">

<style>

html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    background: black;
    display: flex;
    font-family: sans-serif;
}

/* Left: Board */
#boardContainer {
    width: 55%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: black;
    position: relative;
}
#board {
    position: relative;
    width: 900px;
    height: 900px;
}
#boardImg {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.piece {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    border: 3px solid transparent;
    box-shadow: 0 0 6px rgba(0,0,0,0.4);
    transition: left 0.4s ease, top 0.4s ease;
}
  

.red { background: red; border-color: #ff8080; color: white; }
.blue { background: blue; border-color: #66a3ff; color: white; }
.yellow { background: goldenrod; border-color: #ffde59; color: black; }
.green { background: limegreen; border-color: #aaffaa; color: black; }


</style>
<!-- Left: Monopoly board -->
<div id="boardContainer">
<div id="board">

<img id="boardImg" src="map.webp" alt="Monopoly Board">
<div id="p1" class="piece red">p1</div>
<div id="p2" class="piece blue">p2</div>
<div id="p3" class="piece yellow">p3</div>
<div id="p4" class="piece green">p4</div>


</div>
</div>




<script>
async function refreshPieces() {
    try {
        const data = await (await fetch('/pieces.json?t=' + Date.now())).json();

        const colorMap = {
            red:   "p1",
            blue:  "p2",
            yellow:"p3",
            green: "p4"
        };

        const boardPositions = {};

        for (const [color, pos] of Object.entries(data)) {
            if (!pos || typeof pos.x !== "number" || typeof pos.y !== "number") continue;

            const key = `${pos.x}-${pos.y}`;
            if (!boardPositions[key]) boardPositions[key] = [];
            boardPositions[key].push(color);
        }

        for (const [key, colors] of Object.entries(boardPositions)) {
            colors.forEach((color, index) => {
                const id = colorMap[color];
                if (!id) return;

                const el = document.getElementById(id);
                if (!el) return;

                const pos = data[color];
                const offset = 8;  

                el.style.left = (pos.x + index * offset) + "px";
                el.style.top  = (pos.y + index * offset) + "px";
            });
        }
    } catch (err) {
        console.error("Error refreshing pieces:", err);
    }
}

setInterval(refreshPieces, 3000);
</script>


</html>
