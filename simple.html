<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Monopoly Board</title>
<style>
html,body{
  margin:0;
  padding:0;
  height:100%;
  width:100%;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:sans-serif;
}

/* Board container */
#boardContainer{
  width:55%;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  background:black;
  position:relative;
}
#board{
  position:relative;
  width:900px;
  height:900px;
}
#boardImg{
  width:100%;
  height:100%;
  object-fit:contain;
}

/* Pieces */
.piece{
  width:32px;
  height:32px;
  border-radius:50%;
  position:absolute;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  border:3px solid transparent;
  box-shadow:0 0 6px rgba(0,0,0,0.4);
  transition:left 0.4s ease,top 0.4s ease;
  color:white;
}
.red{background:#ff4d4d;border-color:#ff8080;}
.blue{background:#3399ff;border-color:#66a3ff;}
.yellow{background:goldenrod;border-color:#ffde59;color:black;}
.green{background:limegreen;border-color:#aaffaa;color:black;}

/* Central container for money + displays */
#centralDisplayContainer{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  z-index:10;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:20px;
}

/* Money container */
#moneyContainer{
  display:flex;
  flex-direction:column;
  gap:15px;
  width:220px;
}
.moneyBox{
  padding:12px 20px;
  border-radius:10px;
  width:100%;
  text-align:center;
  font-weight:bold;
  font-size:22px;
  word-wrap:break-word;
  box-shadow:0 0 12px #6a0dad,0 0 18px #00d4ff;
  color:white;
}
.moneyBox.red{background:#ff4d4d;}
.moneyBox.blue{background:#3399ff;}
.moneyBox.yellow{background:goldenrod;color:black;}
.moneyBox.green{background:limegreen;color:black;}

/* Display boxes */
#displayContainer{
  display:flex;
  flex-direction:column;
  gap:15px;
  align-items:center;
}
.displayBox{
  padding:15px 20px;
  border-radius:12px;
  width:300px;
  text-align:center;
  font-weight:bold;
  font-size:22px;
  background:linear-gradient(135deg,#6a0dad,#00d4ff);
  color:white;
  box-shadow:0 0 12px #6a0dad,0 0 18px #00d4ff;
  word-wrap:break-word;
}

/* Quick links with absolute positioning */
#propertyLink, #rulesLink{
  position:absolute;
  z-index:20;
}
#propertyLink img, #rulesLink img{
  width:120px;
  border-radius:8px;
  box-shadow:0 0 6px rgba(255,255,255,0.5);
}

/* Example positions: */
#propertyLink{ top:40%; left:200px; transform:translateY(-50%); }
#rulesLink{ top:50%; right:580px; transform:translateY(-50%); }

/* Buildings */
.hotel,.house{
  width:24px;
  height:24px;
  position:absolute;
}
</style>
</head>
<body>
<div id="boardContainer">
<div id="board">
<img id="boardImg" src="map2.webp" alt="Monopoly Board">
<div id="p1" class="piece red">p1</div>
<div id="p2" class="piece blue">p2</div>
<div id="p3" class="piece yellow">p3</div>
<div id="p4" class="piece green">p4</div>
<div id="centralDisplayContainer">
<div id="moneyContainer">
<div id="money-p1-overlay" class="moneyBox red">Player1: $0</div>
<div id="money-p2-overlay" class="moneyBox blue">Player2: $0</div>
<div id="money-p3-overlay" class="moneyBox yellow">Player3: $0</div>
<div id="money-p4-overlay" class="moneyBox green">Player4: $0</div>
</div>
<div id="displayContainer">
<div id="display1" class="displayBox">Display 1</div>
<div id="display2" class="displayBox">Display 2</div>
</div>
</div>
<div id="propertyLink">
<a href="https://raw.githubusercontent.com/nightywolfy/monopoly/main/properties.jpg" target="_blank">
<img src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/properties.jpg">
</a>
</div>
<div id="rulesLink">
<a href="https://raw.githubusercontent.com/nightywolfy/monopoly/main/rules.jpg" target="_blank">
<img src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/rules.jpg">
</a>
</div>
</div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const colorMap = {red:"p1", blue:"p2", yellow:"p3", green:"p4"};

const buildingPositions = {
1:{x:742,y:750},3:{x:597,y:750},6:{x:375,y:750},8:{x:230,y:750},9:{x:155,y:750},
11:{x:104,y:699},12:{x:107,y:630},14:{x:110,y:495},16:{x:114,y:362},17:{x:117,y:299},
19:{x:120,y:175},21:{x:174,y:135},22:{x:240,y:135},24:{x:380,y:135},26:{x:520,y:135},
28:{x:655,y:135},29:{x:724,y:135},31:{x:773,y:173},33:{x:776,y:297},34:{x:779,y:362},
37:{x:786,y:562},39:{x:790,y:697}
};

// Pieces
function updatePieces(data){
  const boardPositions={};
  for(const [color,pos] of Object.entries(data)){
    if(!pos||typeof pos.x!=="number"||typeof pos.y!=="number") continue;
    const key=`${pos.x}-${pos.y}`;
    if(!boardPositions[key]) boardPositions[key]=[];
    boardPositions[key].push(color);
  }
  for(const [key,colors] of Object.entries(boardPositions)){
    colors.forEach((color,index)=>{
      const id=colorMap[color];
      if(!id) return;
      const el=document.getElementById(id);
      const pos=data[color];
      const offset=8;
      el.style.left=(pos.x+index*offset)+'px';
      el.style.top=(pos.y+index*offset)+'px';
    });
  }
}

// Displays
function updateDisplay1(text){ document.getElementById('display1').innerText = text || ''; }
function updateDisplay2(text){ document.getElementById('display2').innerText = text || ''; }

// Money
function updateMoney(data){
  document.getElementById('money-p1-overlay').textContent = 'Player1: $' + data.p1;
  document.getElementById('money-p2-overlay').textContent = 'Player2: $' + data.p2;
  document.getElementById('money-p3-overlay').textContent = 'Player3: $' + data.p3;
  document.getElementById('money-p4-overlay').textContent = 'Player4: $' + data.p4;
}

// Buildings
function renderElements(type,data,imgSrc){
  document.querySelectorAll(`.${type}`).forEach(el=>el.remove());
  const board=document.getElementById('board');
  for(const [space,active] of Object.entries(data)){
    if(active && buildingPositions[space]){
      const pos=buildingPositions[space];
      const el=document.createElement('img');
      el.src=imgSrc;
      el.className=type;
      el.style.left=(pos.x-12)+'px';
      el.style.top=(pos.y-12)+'px';
      board.appendChild(el);
    }
  }
}

// Initial fetch
fetch('/pieces.json').then(res=>res.json()).then(updatePieces);
fetch('/display1.json').then(res=>res.json()).then(data=>updateDisplay1(data.text));
fetch('/display2.json').then(res=>res.json()).then(data=>updateDisplay2(data.text));
fetch('/money.json').then(res=>res.json()).then(updateMoney);
fetch('/hotels.json').then(res=>res.json()).then(data=>renderElements('hotel',data,'https://raw.githubusercontent.com/nightywolfy/monopoly/main/hotel.webp'));
fetch('/houses.json').then(res=>res.json()).then(data=>renderElements('house',data,'https://raw.githubusercontent.com/nightywolfy/monopoly/main/house.webp'));

// Socket.IO updates
socket.on('piecesUpdate',updatePieces);
socket.on('displayUpdate1', data => updateDisplay1(data.text));
socket.on('displayUpdate2', data => updateDisplay2(data.text));
socket.on('moneyUpdate',updateMoney);
socket.on('hotelsUpdate',data=>renderElements('hotel',data,'https://raw.githubusercontent.com/nightywolfy/monopoly/main/hotel.webp'));
socket.on('housesUpdate',data=>renderElements('house',data,'https://raw.githubusercontent.com/nightywolfy/monopoly/main/house.webp'));
</script>
</body>
</html>
