<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Monopoly</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    background: black;
    display: flex;
    font-family: sans-serif;
}

/* Left: Board */
#boardContainer {
    width: 55%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: black;
    position: relative;
}
#board {
    position: relative;
    width: 900px;
    height: 900px;
}
#boardImg {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

/* Right: Controls */
#controlsContainer {
    width: 45%;
    height: 100%;
    background: #111;
    display: flex;
    flex-direction: column;
    padding: 10px;
}

#controlsInner {
    display: flex;
    flex-direction: column;
    height: 100%; /* ensures child iframe fills vertically */
}


/* Chat iframe fills remaining space */
#chatFrame {
    flex-grow: 1;      /* take all remaining vertical space */
    width: 100%;       /* stretch fully horizontally */
    border: none;      /* remove default border */
}

/* Player pieces */
.piece {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    border: 3px solid transparent;
    box-shadow: 0 0 6px rgba(0,0,0,0.4);
    transition: left 0.4s ease, top 0.4s ease;
}
.red { background: red; border-color: #ff8080; color: white; }
.blue { background: blue; border-color: #66a3ff; color: white; }


/* Money overlays */
.moneyOverlay {
    position: absolute;
    padding: 12px 20px;
    font-weight: bold;
    border: 2px solid gold;
    border-radius: 10px;
    font-size: 2.3em;
    background: black;
    min-width: 160px;
    text-align: center;
}
#money-p1-overlay { left: calc(35% + 12.6px); top: 25%; color: #ff6666; }
#money-p2-overlay { left: calc(35% + 12.6px); top: 60%; color: #66ccff; } 


/* House buttons (smaller) */
.white-btn {
    padding: 3px 6px;
    font-size: 0.7em;
    font-weight: bold;
    border-radius: 4px;
    border: 1px solid #ccc;
    background: #fff;
    color: #111;
    cursor: pointer;
    transition: all 0.2s ease;
}
.white-btn:hover {
    background: #f0f0f0;
    transform: translateY(-1px) scale(1.02);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.white-btn:active {
    transform: translateY(1px) scale(0.97);
    box-shadow: 0 1px 2px rgba(0,0,0,0.15);
}

/* Redeem/Mortgage buttons */
.mode-btn {
    padding: 6px 12px;
    font-size: 0.9em;
    border-radius: 5px;
    border: 1px solid #555;
    background: #111;
    color: #eee;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s ease;
}
.mode-btn.active {
    background: #0077ff;
    color: #fff;
    border-color: #00aaff;
}
.mode-btn:hover {
    background: #333;
}

/* Button row container */
#modeToggle {
    position: absolute;
    top: 860px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 6px;
    z-index: 60;
}
#modeToggle > div {
    display: flex;
    gap: 4px;
}

#topButtons button {
    padding: 8px 10px;            /* bigger clickable area */
    font-size: 1em;              /* larger text */
    font-weight: bold;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    color: #fff;
    background: linear-gradient(45deg, #0f4f36, #ff416c);
    box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    transition: all 0.2s ease;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}
#topButtons button:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 10px rgba(0,0,0,0.5);
}
#topButtons button:active {
    transform: translateY(1px) scale(0.98);
    box-shadow: 0 3px 6px rgba(0,0,0,0.3);
}

.hotel, .house {
    width: 24px;
    height: 24px;
}
</style>
</head>
<body>
<div id="boardContainer">
<div id="board">
<img id="boardImg" src="map.webp" alt="Monopoly Board">
<div id="boardButtons"></div>
<div id="p1" class="piece red">p1</div>
<div id="p2" class="piece blue">p2</div>
<div id="money-p1-overlay" class="moneyOverlay">Player1: $0</div>
<div id="money-p2-overlay" class="moneyOverlay">Player2: $0</div>
<a href="https://raw.githubusercontent.com/nightywolfy/monopoly/main/properties.jpg" target="_blank">
<img src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/properties.jpg" style="position:absolute; left:calc(44% - 30px); top:46%; transform:translate(-50%, -50%); width:120px; z-index:20;">
</a>
<a href="https://raw.githubusercontent.com/nightywolfy/monopoly/main/rules.jpg" target="_blank">
<img src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/rules.jpg" style="position:absolute; left:calc(48% + 110px); top:46%; transform:translate(-50%, -50%); width:120px; z-index:21;">
</a>
<audio id="sndBuild2" src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/build2.mp3" preload="auto"></audio>
<audio id="sndBuild3" src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/build3.mp3" preload="auto"></audio>
<audio id="sndDestroy2" src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/destroy2.mp3" preload="auto"></audio>
<audio id="sndDestroy3" src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/destroy3.mp3" preload="auto"></audio>
<div id="modeToggle">
<!-- First 8 buttons -->
<div>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!addonehouse dblue">
<button class="white-btn" onclick="sndBuild2.currentTime=0; sndBuild2.play()">DB+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!addonehouse brown">
<button class="white-btn" onclick="sndBuild3.currentTime=0; sndBuild3.play()">BR+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!addonehouse blue">
<button class="white-btn" onclick="sndBuild3.currentTime=0; sndBuild3.play()">BL+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!addonehouse green">
<button class="white-btn" onclick="sndBuild3.currentTime=0; sndBuild3.play()">GR+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!addonehouse yellow">
<button class="white-btn" onclick="sndBuild3.currentTime=0; sndBuild3.play()">YE+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!addonehouse pink">
<button class="white-btn" onclick="sndBuild3.currentTime=0; sndBuild3.play()">PI+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!addonehouse orange">
<button class="white-btn" onclick="sndBuild3.currentTime=0; sndBuild3.play()">OR+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!addonehouse red">
<button class="white-btn" onclick="sndBuild2.currentTime=0; sndBuild2.play()">RE+</button>
</form>
</div>
 <div>
<button type="button" class="mode-btn active" data-mode="redeem">Redeem</button>
<button type="button" class="mode-btn" data-mode="mortgage">Mortgage</button>
</div>
<!-- Second 8 buttons -->
<div>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!removeonehouse dblue">
<button class="white-btn" onclick="sndDestroy2.currentTime=0; sndDestroy2.play()">DB-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!removeonehouse brown">
<button class="white-btn" onclick="sndDestroy3.currentTime=0; sndDestroy3.play()">BR-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!removeonehouse blue">
<button class="white-btn" onclick="sndDestroy3.currentTime=0; sndDestroy3.play()">BL-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!removeonehouse green">
<button class="white-btn" onclick="sndDestroy3.currentTime=0; sndDestroy3.play()">GR-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!removeonehouse yellow">
<button class="white-btn" onclick="sndDestroy3.currentTime=0; sndDestroy3.play()">YE-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!removeonehouse pink">
<button class="white-btn" onclick="sndDestroy3.currentTime=0; sndDestroy3.play()">PI-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!removeonehouse orange">
<button class="white-btn" onclick="sndDestroy3.currentTime=0; sndDestroy3.play()">OR-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!removeonehouse red">
<button class="white-btn" onclick="sndDestroy2.currentTime=0; sndDestroy2.play()">RE-</button>
</form>
</div>
</div>
</div>
</div>
<!-- Right: Controls + Chat -->
<div id="controlsContainer">
<div id="controlsInner">
<iframe name="hiddenFrame" style="display:none;"></iframe>
<audio id="buttonClickSound" src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/click.mp3" preload="auto"></audio>
<audio id="soldSound" src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/sold.mp3" preload="auto"></audio>
<div id="topButtons" style="margin-bottom:10px; display:flex; flex-wrap:wrap; gap:4px; justify-content:center; align-items:center;">
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!go1">
<button type="submit" class="small-button">GO</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!stopgo">
<button type="submit" class="small-button">ST</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!up">
<button type="submit" class="small-button">UP</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!go3">
<button type="submit" class="small-button">JA</button>
</form>
<div style="width:2px; background:#888; margin:0 4px;"></div>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player1bot">
<input type="hidden" name="msg" value="1">
<button type="submit" onclick="document.getElementById('buttonClickSound').play();">1</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player1bot">
<input type="hidden" name="msg" value="2">
<button type="submit" onclick="document.getElementById('buttonClickSound').play();">2</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player1bot">
<input type="hidden" name="msg" value="3">
<button type="submit" onclick="document.getElementById('buttonClickSound').play();">3</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player1bot">
<input type="hidden" name="msg" value="4">
<button type="submit" onclick="document.getElementById('buttonClickSound').play();">4</button>
</form>
 <form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player1bot">
<input type="hidden" name="msg" value="5">
<button type="submit" onclick="document.getElementById('buttonClickSound').play();">5</button>
</form>
 <form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player1bot">
<input type="hidden" name="msg" value="6">
<button type="submit" onclick="document.getElementById('buttonClickSound').play();">6</button>
</form>
<div style="width:2px; background:#888; margin:0 4px;"></div>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player1bot">
<input type="hidden" name="msg" value="0">
<button type="submit" onclick="document.getElementById('buttonClickSound').play();">0</button>
</form>
 <form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player1bot">
<input type="hidden" name="msg" value="7">
<button type="submit" onclick="document.getElementById('buttonClickSound').play();">7</button>
</form>
<div style="width:2px; background:#888; margin:0 4px;"></div>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!bidadd 5">
<button type="submit" class="small-button">5</button>
</form>
 <form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!bidadd 10">
<button type="submit" class="small-button">10</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!bidadd 25">
<button type="submit" class="small-button">25</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!bidadd 50">
<button type="submit" class="small-button">50</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
<input type="hidden" name="bot" value="player3bot">
<input type="hidden" name="msg" value="!fold">
<button type="submit" class="small-button" onclick="document.getElementById('soldSound').play();">F</button>
</form>
</div>
<iframe id="chatFrame" src="https://web.libera.chat/gamja/##rento" title="IRC Chat" loading="lazy" allow="clipboard-read; clipboard-write"></iframe>
</div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
// Socket setup
const socket = io();

const buildingPositions = {
  1:{x:742,y:750},3:{x:597,y:750},6:{x:375,y:750},8:{x:230,y:750},9:{x:155,y:750},
  11:{x:104,y:699},12:{x:107,y:630},14:{x:110,y:495},16:{x:114,y:362},17:{x:117,y:299},
  19:{x:120,y:175},21:{x:174,y:135},22:{x:240,y:135},24:{x:380,y:135},26:{x:520,y:135},
  28:{x:655,y:135},29:{x:724,y:135},31:{x:773,y:173},33:{x:776,y:297},34:{x:779,y:362},
  37:{x:786,y:562},39:{x:790,y:697}
};

const boardSpaces = [
  { number: 0,  x: 830, y: 770 }, { number: 1,  x: 715, y: 735 },
  { number: 2,  x: 640, y: 735 }, { number: 3,  x: 570, y: 735 },
  { number: 4,  x: 495, y: 735 }, { number: 5,  x: 420, y: 735 },
  { number: 6,  x: 345, y: 735 }, { number: 7,  x: 270, y: 735 },
  { number: 8,  x: 199, y: 735 }, { number: 9,  x: 128, y: 735 },
  { number: 10, x: 40,  y: 735 }, { number: 11, x: 60,  y: 675 },
  { number: 12, x: 63,  y: 605 }, { number: 13, x: 66,  y: 537 },
  { number: 14, x: 69,  y: 468 }, { number: 15, x: 72,  y: 402 },
  { number: 16, x: 75,  y: 338 }, { number: 17, x: 78,  y: 273 },
  { number: 18, x: 75,  y: 209 }, { number: 19, x: 80,  y: 149 },
  { number: 20, x: 80, y: 90  }, { number: 21, x: 140, y: 90  },
  { number: 22, x: 210, y: 90  }, { number: 23, x: 295, y: 90  },
  { number: 24, x: 350, y: 90  }, { number: 25, x: 420, y: 90  },
  { number: 26, x: 490, y: 90  }, { number: 27, x: 555, y: 90  },
  { number: 28, x: 625, y: 90  }, { number: 29, x: 695, y: 90  },
  { number: 30, x: 786, y: 90  }, { number: 31, x: 760, y: 147 },
  { number: 32, x: 765, y: 200 }, { number: 33, x: 763, y: 272 },
  { number: 34, x: 766, y: 337 }, { number: 35, x: 769, y: 402 },
  { number: 36, x: 776, y: 460 }, { number: 37, x: 772, y: 537 },
  { number: 38, x: 774, y: 603 }, { number: 39, x: 777, y: 673 }
];

const allSpaces = [
  1,3,4,5,6,8,9,11,12,13,14,15,16,17,19,21,22,24,25,26,27,28,29,31,33,34,35,37,38,39
];

const group1 = [1,3,4,5,6,8,9,21,22,24,25,26,27,28,29];
const group2 = [11,12,13,14,15,16,17,19,31,33,34,35,37,38,39];

const boardButtonsContainer = document.getElementById('boardButtons');

// Mode toggle logic
const modeButtons = document.querySelectorAll('.mode-btn');
let currentMode = 'redeem';
modeButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        modeButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentMode = btn.dataset.mode;

        boardButtonsContainer.querySelectorAll('button').forEach(b => {
            const spaceNum = b.textContent;
            b.title = `${currentMode.charAt(0).toUpperCase() + currentMode.slice(1)} space ${spaceNum}`;
        });
    });
});

// Helper: play sound (with online MP3s)
function playSound(url) {
    new Audio(url).play().catch(()=>{});
}

// Sound URLs
const soundURLs = {
    redeem: 'https://raw.githubusercontent.com/nightywolfy/monopoly/main/redeem.mp3',
    mortgage: 'https://raw.githubusercontent.com/nightywolfy/monopoly/main/mortgage.mp3'
};

// Generate board buttons
allSpaces.forEach(spaceNum => {
    const coords = boardSpaces.find(b => b.number === spaceNum);
    if (!coords) return;

    const btn = document.createElement('button');
    btn.textContent = spaceNum;
    btn.title = `Redeem space ${spaceNum}`;
    btn.style.position = 'absolute';
    btn.style.left = `${coords.x}px`;
    btn.style.top = `${coords.y}px`;

    if (group1.includes(spaceNum)) {
        btn.style.width = '50px';
        btn.style.height = '50px';
        btn.style.fontSize = '0.85em';
    } else if (group2.includes(spaceNum)) {
        btn.style.width = '50px';
        btn.style.height = '50px';
        btn.style.fontSize = '0.75em';
    } else {
        btn.style.width = '45px';
        btn.style.height = '22px';
        btn.style.fontSize = '0.8em';
    }

    btn.style.backgroundColor = 'rgba(128,128,128,0.4)';
    btn.style.border = '1px solid rgba(255,255,255,0.6)';
    btn.style.color = 'white';
    btn.style.zIndex = 50;
    btn.style.cursor = 'pointer';

    btn.addEventListener('click', () => {
        socket.emit('sendMessage', { bot: 'player3bot', msg: `!${currentMode} ${spaceNum}` });
        playSound(soundURLs[currentMode]);
    });

    boardButtonsContainer.appendChild(btn);
});

// Make board buttons 1-39 invisible but still clickable
boardButtonsContainer.querySelectorAll('button').forEach(btn => {
    const spaceNum = parseInt(btn.textContent);
    if (spaceNum >= 1 && spaceNum <= 39) {
        btn.style.backgroundColor = 'transparent'; // remove visible background
        btn.style.border = 'none';                 // remove border
        btn.style.color = 'transparent';           // hide number text
    }
});

// Refresh board every minute
function refreshBoardImage() {
    const boardImg = document.getElementById('boardImg');
    boardImg.src = 'map.webp?t=' + Date.now();
}
setInterval(refreshBoardImage, 40000);

async function refreshPieces() {
    try {
        const data = await (await fetch('/pieces.json?t=' + Date.now())).json();

        const colorMap = {
            red:   "p1",
            blue:  "p2",
           
        };

        const boardPositions = {};

        for (const [color, pos] of Object.entries(data)) {
            if (!pos || typeof pos.x !== "number" || typeof pos.y !== "number") continue;

            const key = `${pos.x}-${pos.y}`;
            if (!boardPositions[key]) boardPositions[key] = [];
            boardPositions[key].push(color);
        }

        for (const [key, colors] of Object.entries(boardPositions)) {
            colors.forEach((color, index) => {
                const id = colorMap[color];
                if (!id) return;

                const el = document.getElementById(id);
                if (!el) return;

                const pos = data[color];
                const offset = 8;  

                el.style.left = (pos.x + index * offset) + "px";
                el.style.top  = (pos.y + index * offset) + "px";
            });
        }
    } catch (err) {
        console.error("Error refreshing pieces:", err);
    }
}

setInterval(refreshPieces, 9000);
// Refresh money
async function refreshMoney() {
    try {
        const data = await (await fetch('/money.json?t=' + Date.now())).json();
        document.getElementById('money-p1-overlay').textContent = 'Player1: $' + data.p1;
        document.getElementById('money-p2-overlay').textContent = 'Player2: $' + data.p2;
    } catch(e){ console.error(e); }
}
refreshMoney();
setInterval(refreshMoney, 9000);

async function refreshElements(type, url, positions, imgSrc) {
  try {
    const res = await fetch(`${url}?t=${Date.now()}`);
    const data = await res.json();
    document.querySelectorAll(`.${type}`).forEach(el => el.remove());
    const board = document.getElementById('board');
    for (const [space, active] of Object.entries(data)) {
      if (active && positions[space]) {
        const pos = positions[space];
        const el = document.createElement('img');
        el.src = imgSrc;
        el.className = type;
        el.style.position = 'absolute';
        el.style.left = (pos.x - 12) + 'px';
        el.style.top  = (pos.y - 12) + 'px';
        board.appendChild(el);
      }
    }
  } catch (e) { console.error(`Error loading ${type}:`, e); }
}
setInterval(() => refreshElements('hotel', '/hotels.json', buildingPositions, 'https://raw.githubusercontent.com/nightywolfy/monopoly/main/hotel.webp'), 99000);
setInterval(() => refreshElements('house', '/houses.json', buildingPositions, 'https://raw.githubusercontent.com/nightywolfy/monopoly/main/house.webp'), 99000);

</script>
</body>
</html>
