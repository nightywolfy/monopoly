<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Monopoly</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    background: black;
    display: flex;
    font-family: sans-serif;
}

/* Left: Board */
#boardContainer {
    width: 55%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: black;
    position: relative;
}
#board {
    position: relative;
    width: 900px;
    height: 900px;
}
#boardImg {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

/* Right: Controls */
#controlsContainer {
    width: 45%;
    height: 100%;
    background: #111;
    display: flex;
    flex-direction: column;
    padding: 10px;
}

/* Chat iframe fills remaining space */
#chatFrame {
    flex-grow: 1;      
    width: 100%;       
    border: none;      
}

/* Player pieces */
.piece {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    border: 3px solid transparent;
    box-shadow: 0 0 6px rgba(0,0,0,0.4);
    transition: left 0.4s ease, top 0.4s ease;
}
.red { background:red; border-color:#ff8080; color:white; }
.blue { background:blue; border-color:#66a3ff; color:white; }
.yellow { background:goldenrod; border-color:#ffde59; color:black; }
.green { background:limegreen; border-color:#aaffaa; color:black; }

/* Central container for money + display separately */
#centralDisplayContainer {
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:25px;
    z-index:10;
}

/* Money container */
#moneyContainer {
    display:flex;
    flex-direction:column;
    gap:15px;
    width:220px;
}

/* Money boxes */
.moneyBox{
    padding:12px 20px;
    border-radius:10px;
    width:100%;
    text-align:center;
    font-weight:bold;
    font-size:22px;
    word-wrap:break-word;
    box-shadow:0 0 12px #6a0dad,0 0 18px #00d4ff;
    color:white;
}
.moneyBox.red{background:#ff4d4d;}
.moneyBox.blue{background:#3399ff;}
.moneyBox.yellow{background:goldenrod;color:black;}
.moneyBox.green{background:limegreen;color:black;}

/* Quick links */
#quickLinks img{
    width:120px;
    border-radius:8px;
    box-shadow:0 0 6px rgba(255,255,255,0.5);
}
#quickLinks{
    display:flex;
    justify-content:center;
    gap:20px;
    margin-top:15px;
}

/* Display box */
#displayBox{
    padding:20px 30px;
    border-radius:12px;
    width:360px;
    text-align:center;
    font-weight:bold;
    font-size:28px;
    background:linear-gradient(135deg,#6a0dad,#00d4ff);
    color:white;
    box-shadow:0 0 18px #6a0dad,0 0 28px #00d4ff;
    word-wrap:break-word;
}

/* Houses & hotels */
.hotel,.house{
    width:24px;
    height:24px;
    position:absolute;
}

/* Right side buttons (mode toggle, DB/RE forms) */
.white-btn {
    padding: 3px 6px;
    font-size: 0.7em;
    font-weight: bold;
    border-radius: 4px;
    border: 1px solid #ccc;
    background: #fff;
    color: #111;
    cursor: pointer;
    transition: all 0.2s ease;
}
.white-btn:hover {
    background: #f0f0f0;
    transform: translateY(-1px) scale(1.02);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.white-btn:active {
    transform: translateY(1px) scale(0.97);
    box-shadow: 0 1px 2px rgba(0,0,0,0.15);
}

.mode-btn {
    padding: 6px 12px;
    font-size: 0.9em;
    border-radius: 5px;
    border: 1px solid #555;
    background: #111;
    color: #eee;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s ease;
}
.mode-btn.active {
    background: #0077ff;
    color: #fff;
    border-color: #00aaff;
}
.mode-btn:hover {
    background: #333;
}

/* Board buttons container */
#boardButtons{position:absolute;top:0;left:0;width:100%;height:100%;z-index:50;pointer-events:none;}
</style>
</head>
<body>
<div id="boardContainer">
<div id="board">
<img id="boardImg" src="map.webp" alt="Monopoly Board">

<!-- Pieces -->
<div id="p1" class="piece red">p1</div>
<div id="p2" class="piece blue">p2</div>
<div id="p3" class="piece yellow">p3</div>
<div id="p4" class="piece green">p4</div>

<!-- Board buttons -->
<div id="boardButtons"></div>

<!-- Central display container -->
<div id="centralDisplayContainer">
  <!-- Player money -->
  <div id="moneyContainer">
    <div id="money-p1-overlay" class="moneyBox red">Player1: $0</div>
    <div id="money-p2-overlay" class="moneyBox blue">Player2: $0</div>
    <div id="money-p3-overlay" class="moneyBox yellow">Player3: $0</div>
    <div id="money-p4-overlay" class="moneyBox green">Player4: $0</div>
  </div>

  <!-- Quick links -->
  <div id="quickLinks">
    <a href="https://raw.githubusercontent.com/nightywolfy/monopoly/main/properties.jpg" target="_blank">
      <img src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/properties.jpg">
    </a>
    <a href="https://raw.githubusercontent.com/nightywolfy/monopoly/main/rules.jpg" target="_blank">
      <img src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/rules.jpg">
    </a>
  </div>

  <!-- Display box -->
  <div id="displayBox">Welcome!</div>
</div>
</div>
</div>

<!-- Right: Controls -->
<div id="controlsContainer">
<iframe name="hiddenFrame" style="display:none;"></iframe>
<audio id="buttonClickSound" src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/click.mp3" preload="auto"></audio>
<!-- Add mode toggle and forms here like in your IRC forms -->
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const colorMap = {red:"p1", blue:"p2", yellow:"p3", green:"p4"};
const buildingPositions = {
1:{x:742,y:750},3:{x:597,y:750},6:{x:375,y:750},8:{x:230,y:750},9:{x:155,y:750},
11:{x:104,y:699},12:{x:107,y:630},14:{x:110,y:495},16:{x:114,y:362},17:{x:117,y:299},
19:{x:120,y:175},21:{x:174,y:135},22:{x:240,y:135},24:{x:380,y:135},26:{x:520,y:135},
28:{x:655,y:135},29:{x:724,y:135},31:{x:773,y:173},33:{x:776,y:297},34:{x:779,y:362},
37:{x:786,y:562},39:{x:790,y:697}
};

// Pieces
function updatePieces(data){
const boardPositions={};
for(const [color,pos] of Object.entries(data)){
if(!pos||typeof pos.x!=="number"||typeof pos.y!=="number") continue;
const key=`${pos.x}-${pos.y}`;
if(!boardPositions[key]) boardPositions[key]=[];
boardPositions[key].push(color);
}
for(const [key,colors] of Object.entries(boardPositions)){
colors.forEach((color,index)=>{
const id=colorMap[color];
if(!id) return;
const el=document.getElementById(id);
if(!el) return;
const pos=data[color];
const offset=8;
el.style.left=(pos.x+index*offset)+'px';
el.style.top=(pos.y+index*offset)+'px';
});
}
}

// Display
function updateDisplay(text){
document.getElementById('displayBox').innerText = text||'';
}

// Money
function updateMoney(data){
document.getElementById('money-p1-overlay').textContent = 'Player1: $' + data.p1;
document.getElementById('money-p2-overlay').textContent = 'Player2: $' + data.p2;
document.getElementById('money-p3-overlay').textContent = 'Player3: $' + data.p3;
document.getElementById('money-p4-overlay').textContent = 'Player4: $' + data.p4;
}

// Buildings
function renderElements(type,data,imgSrc){
document.querySelectorAll(`.${type}`).forEach(el=>el.remove());
const board=document.getElementById('board');
for(const [space,active] of Object.entries(data)){
if(active && buildingPositions[space]){
const pos=buildingPositions[space];
const el=document.createElement('img');
el.src=imgSrc;
el.className=type;
el.style.left=(pos.x-12)+'px';
el.style.top=(pos.y-12)+'px';
board.appendChild(el);
}
}
}

// Socket.IO updates
socket.on('piecesUpdate',updatePieces);
socket.on('displayUpdate',data=>updateDisplay(data.text));
socket.on('moneyUpdate',updateMoney);
socket.on('hotelsUpdate',data=>renderElements('hotel',data,'https://raw.githubusercontent.com/nightywolfy/monopoly/main/hotel.webp'));
socket.on('housesUpdate',data=>renderElements('house',data,'https://raw.githubusercontent.com/nightywolfy/monopoly/main/house.webp'));
</script>
</body>
</html>
