<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Monopoly Board</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  background: black;
  font-family: sans-serif;
  display: flex;
}

#boardContainer {
  width: 50%;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
  background: black;
}

/* Board inner */
#board {
  position: relative;
  height: 900px;
  width: 900px;

}
#boardImg {
  width: 100%;
  height: 100%;
 
}

#boardWrapper {
  width: 50%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  background: black;
  overflow: hidden;
}

/* Pieces */
.piece {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  position: absolute;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  border: 3px solid transparent;
  box-shadow: 0 0 6px rgba(0,0,0,0.4);
  transition: left 0.4s ease, top 0.4s ease;
  color: white;
}
.red { background:#ff4d4d; border-color:#ff8080; }
.blue { background:#3399ff; border-color:#66a3ff; }
.yellow { background:goldenrod; border-color:#ffde59; color:black; }
.green { background:limegreen; border-color:#aaffaa; color:black; }

/* Central container for money + display */
#centralDisplayContainer {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 25px;
  z-index: 10;
}

#moneyContainer {
  display: flex;
  flex-direction: column;
  gap: 20px;       /* slightly bigger gap */
  width: 175px;    /* wider than before */
}

.moneyBox {
  padding: 10px 20px;   /* bigger padding */
  border-radius: 12px;
  width: 100%;          /* fills container */
  text-align: center;
  font-weight: bold;
  font-size: 20px;      /* larger font */
  word-wrap: break-word;
  box-shadow: 0 0 18px #6a0dad, 0 0 24px #00d4ff;
  color: white;
}
.moneyBox.red { background:#ff4d4d; }
.moneyBox.blue { background:#3399ff; }
.moneyBox.yellow { background:goldenrod; color:black; }
.moneyBox.green { background:limegreen; color:black; }

/* Display boxes */
#displayContainer{
  display:flex;
  flex-direction:column;
  gap:15px;
  align-items:center;
}
.displayBox{
  padding:8px 14px;
  border-radius:12px;
  width:300px;
  text-align:center;
  font-weight:bold;
  font-size:22px;
  background:linear-gradient(135deg,#6a0dad,#00d4ff);
  color:white;
  box-shadow:0 0 12px #6a0dad,0 0 18px #00d4ff;
  word-wrap:break-word;
}

/* Quick links with absolute positioning */
#propertyLink, #rulesLink{
  position:absolute;
  z-index:20;
}
#propertyLink img, #rulesLink img{
  width:75px;
  border-radius:8px;
  box-shadow:0 0 6px rgba(255,255,255,0.5);
}

/* Example positions: */
#propertyLink{ top:40%; left:265px; transform:translateY(-50%); }
#rulesLink{ top:50%; right:560px; transform:translateY(-50%); }

/* Buildings */
.hotel,.house{
  width:29px;
  height:29px;
  position:absolute;
}



/* Redeem/Mortgage buttons */
.mode-btn {
  padding: 6px 12px;
  font-size: 0.9em;
  border-radius: 5px;
  border: 1px solid #555;
  background: #111;
  color: #eee;
  cursor: pointer;
  text-align: center;
  transition: all 0.2s ease;
}
.mode-btn.active {
  background: #0077ff;
  color: #fff;
  border-color: #00aaff;
}
.mode-btn:hover {
  background: #333;
}

#modeToggle {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 2px;
  margin-top: -7px; /* closer to map.webp */
  z-index: 60;
  position: relative;
}

/* Top buttons */
#topButtons button {
  padding: 8px 10px;
  font-size: 1em;
  font-weight: bold;
  cursor: pointer;
  border: none;
  border-radius: 8px;
  color: #fff;
  background: linear-gradient(45deg, #0f4f36, #ff416c);
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  transition: all 0.2s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}
#topButtons button:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 6px 10px rgba(0,0,0,0.5);
}
#topButtons button:active {
  transform: translateY(1px) scale(0.98);
  box-shadow: 0 3px 6px rgba(0,0,0,0.3);
}

/* Small buttons */
.small-button {
  padding: 2px 4px;
  font-size: 0.9em;
  border-radius: 6px;
  background: #222;
  color: white;
  cursor: pointer;
}

/* Right: Controls */
#controlsContainer {
  width: 50%;
  height: 100%;
  background: #111;
  display: flex;
  flex-direction: column;
}

/* Inner container for buttons + chat */
#controlsInner {
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: 10px;
  box-sizing: border-box;
}

/* Chat iframe fills remaining space */
#chatFrame {
  flex-grow: 1;
  width: 100%;
  border: none;
  min-height: 0;
}

/* + buttons green */
.white-btn.plus {
  background-color: #28a745 !important;  /* green */
  border: 1px solid #1e7e34 !important;
  color: white !important;
  padding: .1px .1px;
  border-radius: 3px;
  font-weight: bold;
  cursor: pointer;
}

/* - buttons red */
.white-btn.minus {
  background-color: #dc3545 !important;  /* red */
  border: 1px solid #b02a37 !important;
  color: white !important;
  padding: .1px .1px;
  border-radius: 3px;
  font-weight: bold;
  cursor: pointer;
}

/* optional hover effect */
.white-btn.plus:hover { background-color: #218838 !important; }
.white-btn.minus:hover { background-color: #c82333 !important; }

.dot {
  width:12px;
  height:12px;
  border-radius:50%;
  position:absolute;
  z-index:30;
  border:2px solid black; /* outer black border */
  box-shadow: 0 0 1px 1px white; /* optional inner border/highlight */
}

</style>
</head>
<body>

<!-- Left: Board -->
<div id="boardWrapper">
<div id="boardContainer">
<div id="board">
<img id="boardImg" src="map2.png" alt="Monopoly Board">
<div id="p1" class="piece red">p1</div>
<div id="p2" class="piece blue">p2</div>
<div id="p3" class="piece yellow">p3</div>
<div id="p4" class="piece green">p4</div>
<div id="boardButtons"></div>
<div id="centralDisplayContainer">
<div id="moneyContainer">
<div id="money-p1-overlay" class="moneyBox red">Player1: $0</div>
<div id="money-p2-overlay" class="moneyBox blue">Player2: $0</div>
<div id="money-p3-overlay" class="moneyBox yellow">Player3: $0</div>
<div id="money-p4-overlay" class="moneyBox green">Player4: $0</div>
</div>
<div id="displayContainer">
<div id="display1" class="displayBox">Display 1</div>
<div id="display2" class="displayBox">Display 2</div>
</div>
</div>
<div id="propertyLink">
<a href="https://raw.githubusercontent.com/nightywolfy/monopoly/main/property3.png" target="_blank">
<img src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/property3.png">
</a>
</div>
<div id="rulesLink">
<a href="https://raw.githubusercontent.com/nightywolfy/monopoly/main/rules.jpg" target="_blank">
<img src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/rules.jpg">
</a>
</div>
</div>
<!-- Mode buttons BELOW the map -->
<div id="modeToggle">
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse dblue">
  <button class="white-btn plus">DB+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse brown">
  <button class="white-btn plus">BR+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse blue">
  <button class="white-btn plus">BL+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse green">
  <button class="white-btn plus">GR+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse yellow">
  <button class="white-btn plus">YE+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse pink">
  <button class="white-btn plus">PI+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse orange">
  <button class="white-btn plus">OR+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse red">
  <button class="white-btn plus">RE+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse white">
  <button class="white-btn plus">WH+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse aqua">
  <button class="white-btn plus">AQ+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse purple">
  <button class="white-btn plus">PU+</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!addonehouse black">
  <button class="white-btn plus">BL+</button>
</form>

<button type="button" class="mode-btn active" data-mode="redeem">Redeem</button>
<button type="button" class="mode-btn" data-mode="mortgage">Mortgage</button>

<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse dblue">
  <button class="white-btn minus">DB-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse brown">
  <button class="white-btn minus">BR-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse blue">
  <button class="white-btn minus">BL-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse green">
  <button class="white-btn minus">GR-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse yellow">
  <button class="white-btn minus">YE-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse pink">
  <button class="white-btn minus">PI-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse orange">
  <button class="white-btn minus">OR-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse red">
  <button class="white-btn minus">RE-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse white">
  <button class="white-btn minus">WH-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse aqua">
  <button class="white-btn minus">AQ-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse purple">
  <button class="white-btn minus">PU-</button>
</form>
<form action="/send-irc" method="POST" target="hiddenFrame">
  <input type="hidden" name="bot" value="player4bot">
  <input type="hidden" name="msg" value="!removeonehouse black">
  <button class="white-btn minus">BL-</button>
</form>


</div>
</div>
</div>

<div id="controlsContainer">
<div id="controlsInner">
<iframe name="hiddenFrame" style="display:none;"></iframe>
<audio id="buttonClickSound" src="https://raw.githubusercontent.com/nightywolfy/monopoly/main/click.mp3" preload="auto"></audio>
<div id="topButtons" style="margin-bottom:10px; display:flex; flex-wrap:wrap; gap:4px; justify-content:center; align-items:center;">

<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!dice1-p4"><button type="submit" class="small-button">D1</button></form>
<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!dice2-p4"><button type="submit" class="small-button">D2</button></form>
<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!dice3-p4"><button type="submit" class="small-button">D3</button></form>
<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!dice4-p4"><button type="submit" class="small-button">DJ</button></form>

<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!up"><button type="submit" class="small-button">UP4</button></form>
<div style="width:2px; background:#888; margin:0 4px;"></div>
<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!add p4 -25"><button type="submit" class="small-button">-25</button></form>
<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!add p4 -5"><button type="submit" class="small-button">-5</button></form>
<div style="width:4px; background:#888; margin:0 4px;"></div>
<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!bidadd 5"><button type="submit" class="small-button">5</button></form>
<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!bidadd 10"><button type="submit" class="small-button">10</button></form>
<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!bidadd 25"><button type="submit" class="small-button">25</button></form>
<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!bidadd 50"><button type="submit" class="small-button">50</button></form>
<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!bidadd 90"><button type="submit" class="small-button">90</button></form>
<form action="/send-irc" method="POST" target="hiddenFrame"><input type="hidden" name="bot" value="player4bot"><input type="hidden" name="msg" value="!fold"><button type="submit" class="small-button">F</button></form>
</div>
<iframe id="chatFrame" src="https://web.libera.chat/gamja/##rento" title="IRC Chat" loading="lazy" allow="clipboard-read; clipboard-write"></iframe>
</div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let currentMap = 1;
let activeDots = {};
const colorMap = {red:"p1", blue:"p2", yellow:"p3", green:"p4"};
const buildingPositions = {
  1: { x: 740, y: 795 },
  3: { x: 595, y: 795 },
  6: { x: 373, y: 795 },
  8: { x: 232, y: 795 },
  9: { x: 160, y: 795 },
  11: { x: 105, y: 735 },
  12: { x: 105, y: 665 },
  14: { x: 105, y: 515 },
  16: { x: 105, y: 375 },
  17: { x: 105, y: 300 },
  19: { x: 105, y: 155 },
  21: { x: 156, y: 105 },
  22: { x: 230, y: 105 },
  24: { x: 375, y: 105 },
  26: { x: 520, y: 105 },
  28: { x: 665, y: 105 },
  29: { x: 740, y: 105 },
  31: { x: 793, y: 155 },
  33: { x: 793, y: 300 },
  34: { x: 793, y: 370 },
  37: { x: 793, y: 590 },
  39: { x: 793, y: 730 },
  0: { x: 595, y: 680 },
  4: { x: 525, y: 680 },
  5: { x: 678, y: 590 },
  10: { x: 305, y: 680 },
  13: { x: 218, y: 590 },
  15: { x: 380, y: 680 },
  20: { x: 218, y: 305 },
  25: { x: 218, y: 375 },
  27: { x: 304, y: 220 },
  30: { x: 595, y: 220 },
  35: { x: 678, y: 305 },
  38: { x: 523, y: 220 }
};

function renderDotsFromServer(data){
  const board = document.getElementById('board');
  if(!data) return;
  for(const [num, info] of Object.entries(data)){
    if(!info) continue;
    if(activeDots[num]){
      // Update existing dot
      const el = activeDots[num];
      el.style.left = info.x+'px';
      el.style.top = info.y+'px';
      el.style.background = info.color || '#fff';
    } else {
      // Create new dot
      const el = document.createElement('div');
      el.className = 'dot';
      el.style.left = info.x+'px';
      el.style.top = info.y+'px';
      el.style.background = info.color || '#fff';
      el.style.zIndex = 30;
      board.appendChild(el);
      activeDots[num] = el;
    }
  }
}


function updatePieces(data){
    if(!data || typeof data !== 'object'){
        console.warn("Pieces data invalid:", data);
        return;
    }

    // Map positions to arrays of colors (to detect overlaps)
    const posMap = {};

    for(const [color, pos] of Object.entries(data)){
        if(!pos || typeof pos.x !== "number" || typeof pos.y !== "number"){
            console.warn("Invalid position for", color, pos);
            continue;
        }

        const key = `${pos.x},${pos.y}`;
        if(!posMap[key]) posMap[key] = [];
        posMap[key].push(color);
    }

    for(const [key, colors] of Object.entries(posMap)){
        const [baseX, baseY] = key.split(',').map(Number);

        colors.forEach((color, idx) => {
            const id = colorMap[color];
            if(!id) return;
            const el = document.getElementById(id);
            if(!el) return;

            // Slight offsets for overlapping pieces
            let offsetX = 0, offsetY = 0;
            if(idx === 1){ offsetX = 10; offsetY = 0; }  // second player
            if(idx === 2){ offsetX = 0; offsetY = 10; }  // third player
            if(idx === 3){ offsetX = 10; offsetY = 10; } // fourth player

            el.style.left = (baseX + offsetX) + 'px';
            el.style.top  = (baseY + offsetY) + 'px';
            el.style.zIndex = 20;
        });
    }
}


// Displays
function updateDisplay1(text){ document.getElementById('display1').innerText = text || ''; }
function updateDisplay2(text){ document.getElementById('display2').innerText = text || ''; }

// Money
function updateMoney(data){
document.getElementById('money-p1-overlay').textContent = 'Player1: $' + data.p1;
document.getElementById('money-p2-overlay').textContent = 'Player2: $' + data.p2;
document.getElementById('money-p3-overlay').textContent = 'Player3: $' + data.p3;
document.getElementById('money-p4-overlay').textContent = 'Player4: $' + data.p4;
}

function renderBuildings(data){
  const board = document.getElementById('board');
  document.querySelectorAll('.house, .hotel').forEach(el => el.remove());
  if(!data) return;
  for(const [space, type] of Object.entries(data)){
      const pos = buildingPositions[space]; 
      if(!pos) continue;
      const el = document.createElement('img');
      el.src = type==='house'?'house.webp':'hotel.webp';
      el.className = type;
      el.style.position='absolute';
      el.style.left=(pos.x-14)+'px';
      el.style.top=(pos.y-14)+'px';
      el.style.width='29px';
      el.style.height='29px';
      el.style.zIndex = type==='house'?25:26;
      board.appendChild(el);
  }
}



const boardSpaces = [
  { number: 1, x: 717, y: 779 }, 
  { number: 3, x: 572, y: 779 },
  { number: 4, x: 500, y: 779 }, 
  { number: 5, x: 425, y: 779 }, 
  { number: 6, x: 355, y: 779 }, 
  { number: 8, x: 210, y: 779 }, 
  { number: 9, x: 138, y: 779 }, 
  { number: 11, x: 75, y: 715 },
  { number: 12, x: 75, y: 643 }, 
  { number: 13, x: 75, y: 570 }, 
  { number: 14, x: 75, y: 498 }, 
  { number: 15, x: 75, y: 425 },
  { number: 16, x: 75, y: 355 }, 
  { number: 17, x: 75, y: 283 }, 
  { number: 19, x: 75, y: 138 },
  { number: 21, x: 134, y: 74 }, 
  { number: 22, x: 204, y: 74 }, 
  { number: 24, x: 352, y: 74 }, 
  { number: 25, x: 424, y: 74 }, 
  { number: 26, x: 497, y: 74 }, 
  { number: 27, x: 569, y: 74 },
  { number: 28, x: 644, y: 74 }, 
  { number: 29, x: 714, y: 74 }, 
  { number: 31, x: 774, y: 135 },
  { number: 33, x: 774, y: 280 },
  { number: 34, x: 774, y: 350 },
  { number: 35, x: 774, y: 420 },
  { number: 37, x: 774, y: 570 },
  { number: 38, x: 774, y: 640 },
  { number: 39, x: 774, y: 712 },
  { number: 40, x: 650, y: 650 },
  { number: 41, x: 570, y: 660 },
  { number: 42, x: 495, y: 660 },
  { number: 44, x: 355, y: 660 },
  { number: 45, x: 280, y: 660 },
  { number: 46, x: 140, y: 650 },
  { number: 47, x: 190, y: 570 },
  { number: 50, x: 190, y: 350 },
  { number: 51, x: 190, y: 280 },
  { number: 52, x: 140, y: 150 },
  { number: 53, x: 280, y: 187 },
  { number: 56, x: 495, y: 187 },
  { number: 57, x: 568, y: 187 },
  { number: 58, x: 650, y: 145 },
  { number: 59, x: 660, y: 275 },
  { number: 63, x: 660, y: 568 }
 
];


const allSpaces = [
  1,3,4,5,6,8,9,11,12,13,14,15,16,17,19,21,22,24,25,26,27,28,29,31,33,34,35,37,38,39,40,41,42,44,45,46,47,50,51,52,53,56,57,58,59,63
];

const group1 = [1,3,4,5,6,8,9,21,22,24,25,26,27,28,29,41,42,44,45,53,56,57];
const group2 = [11,12,13,14,15,16,17,19,31,33,34,35,37,38,39,47,50,51,59,63];

const boardButtonsContainer = document.getElementById('boardButtons');

// Mode toggle logic
const modeButtons = document.querySelectorAll('.mode-btn');
let currentMode = 'redeem';
modeButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        modeButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentMode = btn.dataset.mode;

        boardButtonsContainer.querySelectorAll('button').forEach(b => {
            const spaceNum = b.textContent;
            b.title = `${currentMode.charAt(0).toUpperCase() + currentMode.slice(1)} space ${spaceNum}`;
        });
    });
});

// Play sound
function playSound(filename) {
    new Audio(filename).play().catch(()=>{});
}

// Sound URLs
const soundURLs = {
    redeem: 'https://raw.githubusercontent.com/nightywolfy/monopoly/main/redeem.mp3',
    mortgage: 'https://raw.githubusercontent.com/nightywolfy/monopoly/main/mortgage.mp3'
};

// Generate board buttons
allSpaces.forEach(spaceNum => {
    const coords = boardSpaces.find(b => b.number === spaceNum);
    if (!coords) return;

    const btn = document.createElement('button');
    btn.textContent = spaceNum;
    btn.style.position = 'absolute';
    btn.style.left = `${coords.x}px`;
    btn.style.top = `${coords.y}px`;

    if (group1.includes(spaceNum)) {
        btn.style.width = '50px';
        btn.style.height = '50px';
        btn.style.fontSize = '0.85em';
    } else if (group2.includes(spaceNum)) {
        btn.style.width = '50px';
        btn.style.height = '50px';
        btn.style.fontSize = '0.75em';
    } else {
        btn.style.width = '110px';
        btn.style.height = '110px';
        btn.style.fontSize = '0.8em';
    }

    btn.style.backgroundColor = 'rgba(128,128,128,0.4)';
    btn.style.border = '1px solid rgba(255,255,255,0.6)';
    btn.style.color = 'white';
    btn.style.zIndex = 50;
    btn.style.cursor = 'pointer';

    btn.addEventListener('click', () => {
        socket.emit('sendMessage', { bot: 'player4bot', msg: `!${currentMode} ${spaceNum}` });
       
    });

    boardButtonsContainer.appendChild(btn);
});

// Make board buttons invisible
boardButtonsContainer.querySelectorAll('button').forEach(btn => {
    const spaceNum = parseInt(btn.textContent);
    if (spaceNum >= 1 && spaceNum <= 63) {
        btn.style.backgroundColor = 'transparent';
        btn.style.border = 'none';
        btn.style.color = 'transparent';
    }
});

function scaleBoard() {
  const container = document.getElementById('boardContainer');
  const wrapper = document.getElementById('boardWrapper');

  const scaleX = wrapper.clientWidth / 930; // board original width
  const scaleY = wrapper.clientHeight / 930; // board original height
  const scale = Math.min(scaleX, scaleY);

  container.style.transform = `scale(${scale})`;
}

window.addEventListener('resize', scaleBoard);
scaleBoard(); // initial scale

socket.on('play-sound', ({ file }) => {
  if (!file) return;
  const audio = new Audio(file);
  audio.play().catch(err => console.error('Audio play error:', err));
});

socket.on('piecesUpdate', updatePieces);
socket.on('draw-dot', info => { renderDotsFromServer({[info.num]: info}); });
socket.on('map-change', n => document.getElementById('boardImg').src = `map${n}.png`);
socket.on('reload-dots', data => { renderDotsFromServer(data); });
socket.on('displayUpdate1', data=>updateDisplay1(data.text));
socket.on('displayUpdate2', data=>updateDisplay2(data.text));
socket.on('moneyUpdate', updateMoney);
socket.on('buildingsUpdate', renderBuildings);
socket.on('remove-dot',n=>{if(activeDots[n]){activeDots[n].remove();delete activeDots[n];}});
socket.on('clear-all-dots',()=>{Object.values(activeDots).forEach(e=>e.remove());activeDots={};});

// Initial fetch
fetch('/pieces.json').then(res=>res.json()).then(updatePieces);
fetch('/display1.json').then(res=>res.json()).then(data=>updateDisplay1(data.text));
fetch('/display2.json').then(res=>res.json()).then(data=>updateDisplay2(data.text));
fetch('/money.json').then(res=>res.json()).then(updateMoney);
fetch('/building.json').then(r=>r.json()).then(renderBuildings);

</script>
</body>
</html>
